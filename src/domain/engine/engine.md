# üß† `domain.engine/` ‚Äî –õ–æ–≥–∏–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ –±–æ—è

–ú–æ–¥—É–ª—å `domain.engine` —Å–æ–¥–µ—Ä–∂–∏—Ç **—è–¥—Ä–æ —Å–∏–º—É–ª—è—Ü–∏–∏ –∏–≥—Ä–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–æ —Ç–∏–∫–æ–≤–æ–π –º–æ–¥–µ–ª–∏**.  
–û–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:

- –ø—Ä–æ–≥—Ä–µ—Å—Å —Ç–∏–∫–∞ (`event_tick`)
- –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π (`apply_ability`)
- —Ä–∞—Å—á–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (`damage`, `heal`, `effects`)
- –≤—ã–±–æ—Ä —Ü–µ–ª–µ–π (`chain targeting`)
- –∑–∞–ø–∏—Å—å –±–æ–µ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (`stats_tracker`)

---

## üîÅ `event_loop.py` ‚Äî –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª —Å–∏–º—É–ª—è—Ü–∏–∏

–§—É–Ω–∫—Ü–∏—è `event_tick(state, intents)`:

1. **–û–±–Ω–æ–≤–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç—ã** (—É–º–µ–Ω—å—à–∞–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å).
2. **–ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∑–æ–Ω—ã** (regen_zone).
3. **–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç AP**.
4. **–í—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è —é–Ω–∏—Ç–æ–≤**:
   - –µ—Å–ª–∏ –∏–¥–µ—Ç –∫–∞—Å—Ç ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
   - –µ—Å–ª–∏ –ø—Ä–∏—à–µ–ª –Ω–æ–≤—ã–π –∏–Ω—Ç–µ–Ω—Ç ‚Üí –ø—Ä–µ—Ä—ã–≤–∞–µ–º –∏ –∑–∞–º–µ–Ω—è–µ–º
   - –∏–Ω–∞—á–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ç–µ–∫—É—â–µ–µ (–¥–≤–∏–∂–µ–Ω–∏–µ/–æ–∂–∏–¥–∞–Ω–∏–µ)

**–ï—Å–ª–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —ç—Ñ—Ñ–µ–∫—Ç—ã** ‚Äî –æ–Ω–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `apply_ability`.

---

## ‚ú® `applier.py` ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π

–§—É–Ω–∫—Ü–∏—è `apply_ability(...)`:
- —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ `stats_tracker`
- –≤—ã–±–∏—Ä–∞–µ—Ç —Ü–µ–ª–∏ (—É—á–∏—Ç—ã–≤–∞—è AoE)
- –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∫–∞–∂–¥—ã–π `Effect`:
  - `DAMAGE` ‚Üí `apply_damage_to_unit`
  - `HEAL` ‚Üí `apply_heal_to_unit`
  - `BUFF/DEBUFF/SHIELD` ‚Üí `add_effect_to_unit`

---

## üîó `ability_utils.py` ‚Äî –≤—ã–±–æ—Ä —Ü–µ–ª–µ–π

- `select_chain_targets(...)` ‚Äî –¥–ª—è —Ü–µ–ø–Ω—ã—Ö –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π:
  –≤—ã–±–∏—Ä–∞–µ—Ç –¥–æ N –±–ª–∏–∂–∞–π—à–∏—Ö —Ü–µ–ª–µ–π –≤ —Ä–∞–¥–∏—É—Å–µ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞.

---

## üß™ `combat.py` ‚Äî –ø—Ä–∏–º–∏—Ç–∏–≤—ã —É—Ä–æ–Ω–∞/—Ö–∏–ª–∞

- `calculate_damage()` ‚Äî —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ BUFF-—ç—Ñ—Ñ–µ–∫—Ç—ã.
- `apply_damage_to_unit()` ‚Äî —É—Ä–æ–Ω —Å —É—á–µ—Ç–æ–º —â–∏—Ç–∞.
- `apply_heal_to_unit()` ‚Äî —Ö–∏–ª –¥–æ max_hp.
- `add_effect_to_unit()` ‚Äî –Ω–∞–≤–µ—à–∏–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç.

---

## üß© –í–∑–∞–∏–º–æ—Å–≤—è–∑–∏:

- `event_loop` –≤—ã–∑—ã–≤–∞–µ—Ç `apply_ability`
- `apply_ability` –≤—ã–∑—ã–≤–∞–µ—Ç `combat` –∏ `stats`
- –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `GameState` –∏ `HeroUnit`

---

## üí° –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```python
state, executed, done = event_tick(state, intents)
```

---

## üìå –ì–¥–µ –ª–æ–≥–∏–∫–∞ –ù–ï –∂–∏–≤–µ—Ç:
- –ù–∏–∫–∞–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ —É—Å–ª–æ–≤–∏–π/AI ‚Äî —Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ.
- –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (LoS, range) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–¥–µ–ª–∞–Ω—ã –¥–æ –ø–µ—Ä–µ–¥–∞—á–∏ `intent`.